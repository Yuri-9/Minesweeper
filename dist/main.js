(()=>{"use strict";const s=class{constructor(s,e="div",t="",i=""){const n=document.createElement(e);n.className=t,n.innerHTML=i,s&&s.append(n),this.node=n}destroy(){this.node.remove()}setContent(s){this.node.innerHTML=s}setClassName(s){this.node.className=s}isHidden(){return"none"===this.node.style.display}},e={1:"#0000fa",2:"#4b802d",3:"#db1300",4:"#202081",5:"#202081",6:"#202081",7:"#202081",8:"#202081"};class t extends s{constructor(s,e,t,i,n){super(s,"button","cell"),this.row=e,this.column=t,this.onOpen=i,this.onMarkMine=n,this.neighborCellsCount=0,this.init(),this.isOpen=!1,this.hasMine=!1,this.hasFlag=!1,this.onOpen=i}checkIsOpen(){return!!this.isOpen||(this.isOpen=!0,!1)}increaseNeighborCellCount(){this.neighborCellsCount++}isEmpty(){return!this.hasMine&&!this.neighborCellsCount}setMine(){this.hasMine=!0,this.neighborCellsCount=0,this.setContent("")}openCell(s=!1){!s&&this.hasFlag||(this.isOpen=!0,this.node.classList.add("open"),this.neighborCellsCount&&(this.setContent(this.neighborCellsCount.toString()),this.node.style.color=e[this.neighborCellsCount]),this.hasMine&&this.node.classList.add("has-mine"))}markMine(){this.isOpen||(this.hasFlag=!this.hasFlag,this.hasFlag?this.node.classList.add("has-flag"):this.node.classList.remove("has-flag"))}init(){this.node.addEventListener("click",(()=>this.onOpen(this.row,this.column))),this.node.addEventListener("contextmenu",(s=>this.onMarkMine(s,this.row,this.column)))}}const i=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];class n extends s{constructor(s,e,t){super(s,"div","board"),this.onGameOver=e,this.onChangeMarkedMines=t,this.openCell=(s,e)=>{var t;this.steps++;const n=null===(t=this.cells[s])||void 0===t?void 0:t[e];n.isOpen||(n.openCell(),n.hasMine?this.onGameOver(!1,this.steps):this.mines||!this.checkIsWin()?n.isEmpty()&&i.forEach((([t,i])=>{var n;const h=s+t,o=e+i,l=null===(n=this.cells[h])||void 0===n?void 0:n[o];l&&!l.hasMine&&this.openCell(s+t,e+i)})):this.onGameOver(!0,this.steps))},this.handleOpenCell=(s,e)=>{this.openCell(s,e)},this.markMine=(s,e,t)=>{var i;const n=null===(i=this.cells[e])||void 0===i?void 0:i[t];if(this.mines){if(n.markMine(),this.mines=n.hasFlag?this.mines-1:this.mines+1,this.onChangeMarkedMines(this.mines),!this.mines&&this.checkIsWin())return void this.onGameOver(!0,this.steps)}else this.openCell(e,t)},this.handleMarkMine=(s,e,t)=>{this.steps++,s.preventDefault(),this.markMine(s,e,t)},this.cells=[],this.steps=0,this.node.addEventListener("click",(s=>{s.preventDefault()})),this.node.addEventListener("contextmenu",(s=>{s.preventDefault()}))}fillMines(){this.rows=this.cells.length,this.columns=this.cells[0].length;let s=0;for(;s<this.size;){const e=Math.floor(Math.random()*this.rows),t=Math.floor(Math.random()*this.columns);this.cells[e][t].hasMine||(this.cells[e][t].setMine(),this.addCountMinesToNeighborCell(e,t),s++)}}addCountMinesToNeighborCell(s,e){i.forEach((([t,i])=>{var n;const h=null===(n=this.cells[s+t])||void 0===n?void 0:n[e+i];h&&!h.hasMine&&this.cells[s+t][e+i].increaseNeighborCellCount()}))}checkIsWin(){var s;let e=0;for(let t=0;t<this.rows;t++)for(let i=0;i<this.columns;i++){const n=null===(s=this.cells[t])||void 0===s?void 0:s[i];n.isOpen||n.hasFlag||e++}return!e}openBoard(){var s;for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)null===(s=this.cells[e])||void 0===s||s[t].openCell(!0)}create(e=10,i=10){this.size=e,this.mines=i;for(let i=0;i<e;i++){const n=new s(this.node,"div","board_row");this.cells[i]=[];for(let s=0;s<e;s++){const e=new t(n.node,i,s,this.handleOpenCell,this.handleMarkMine);this.cells[i].push(e)}}}}const h=s=>{const e="000"+s;return e.substring(e.length-3)};class o extends s{constructor(s,e){super(s,"div","mins"),this.minsCount=e}render(s){this.setContent(h(s))}}class l extends s{constructor(s){super(s,"div","mins"),this.seconds=0,this.show()}start(){console.log("start"),this.timerId=setInterval((()=>{this.seconds=this.seconds+1,this.show()}),1e3)}stop(){clearInterval(this.timerId)}reset(){this.seconds=0,this.show()}show(){this.setContent(h(this.seconds))}}class r extends s{constructor(e,t){super(e,"div","menu"),this.minsField=new o(this.node,10),this.resetButton=new s(this.node,"button","menu_button-reset","reset"),this.resetButton.node.addEventListener("click",t),this.timerField=new l(this.node)}}class a{constructor(s){this.handleChangeMarkedMines=s=>{this.menu.minsField.render(s)},this.gameOver=(s,e)=>{console.log("isWin",s,e),this.board.openBoard(),s?this.menu.resetButton.setContent("win"):this.menu.resetButton.setContent("fail"),this.menu.timerField.stop()},this.parentNode=s,this.menu=new r(s,(()=>this.reset()))}init(){this.board=new n(this.parentNode,this.gameOver,this.handleChangeMarkedMines),this.startGameHandler=()=>{this.start()},this.board.node.addEventListener("click",this.startGameHandler),this.board.create(10,10),this.menu.minsField.render(this.board.mines),this.board.fillMines()}start(){this.isPlayGame||(this.isPlayGame=!0,this.menu.timerField.start())}reset(){this.isPlayGame=!1,this.board.destroy(),removeEventListener("click",this.startGameHandler),this.menu.timerField.stop(),this.menu.timerField.reset(),this.menu.resetButton.setContent("game"),this.init()}}class d{constructor(s){this.game=new a(s)}init(){this.game.init()}}window.onload=()=>{const s=document.body;if(!s)throw Error("App root element not found");new d(s).init()}})();